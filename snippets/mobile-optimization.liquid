{% comment %}
  Mobile Optimization - Universal Device Support
  Ensures optimal display on:
  - Samsung Galaxy S25 (360-412px)
  - iPhone SE (375px)
  - iPhone 13/14/15 (390px)
  - iPhone 14/15 Plus/Pro Max (428px)
{% endcomment %}

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">

<style>
  /* ===== UNIVERSAL MOBILE OPTIMIZATIONS ===== */
  
  /* Base Mobile Styles - All Devices */
  @media (max-width: 768px) {
    * {
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
      -webkit-touch-callout: none;
    }
    
    html {
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      touch-action: manipulation;
    }
    
    body {
      overflow-x: hidden;
      max-width: 100vw;
      position: relative;
    }
    
    /* Ensure all containers respect viewport */
    .page-width,
    .container,
    section {
      max-width: 100vw;
      overflow-x: hidden;
    }
    
    /* Better touch targets */
    button,
    a,
    input[type="button"],
    input[type="submit"],
    .btn {
      min-height: 44px;
      min-width: 44px;
    }
    
    /* Prevent text overflow */
    h1, h2, h3, h4, h5, h6, p {
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }
  }
  
  /* ===== SAMSUNG GALAXY S25 & SIMILAR (360px - 412px) ===== */
  @media (max-width: 428px) and (min-width: 360px) {
    body {
      font-size: 16px; /* Prevent zoom on input focus */
    }
    
    input,
    textarea,
    select {
      font-size: 16px !important; /* Prevent iOS zoom */
    }
    
    /* Optimize padding for narrower screens */
    section {
      padding-left: 16px;
      padding-right: 16px;
    }
    
    /* Better button sizing */
    .btn,
    button {
      padding: 12px 20px;
      font-size: 15px;
    }
  }
  
  /* ===== IPHONE SE & SMALL DEVICES (320px - 375px) ===== */
  @media (max-width: 375px) {
    body {
      font-size: 15px;
    }
    
    h1 {
      font-size: 24px;
      line-height: 1.2;
    }
    
    h2 {
      font-size: 20px;
      line-height: 1.3;
    }
    
    h3 {
      font-size: 18px;
      line-height: 1.3;
    }
    
    /* Tighter spacing for small screens */
    section {
      padding: 20px 12px;
    }
    
    /* Stack items more aggressively */
    .grid,
    .flex-row {
      flex-direction: column !important;
      gap: 12px;
    }
  }
  
  /* ===== IPHONE 13/14/15 STANDARD (390px) ===== */
  @media (width: 390px) {
    /* Optimal sizing for this specific width */
    .container {
      padding: 0 18px;
    }
  }
  
  /* ===== IPHONE PRO MAX & LARGE PHONES (414px - 430px) ===== */
  @media (min-width: 414px) and (max-width: 430px) {
    /* Utilize extra width */
    .container {
      padding: 0 20px;
    }
    
    /* Can afford slightly larger text */
    body {
      font-size: 17px;
    }
  }
  
  /* ===== LANDSCAPE ORIENTATION ===== */
  @media (max-height: 500px) and (orientation: landscape) {
    /* Optimize for landscape mode */
    section {
      padding-top: 16px;
      padding-bottom: 16px;
    }
    
    /* Reduce header sizes in landscape */
    h1 {
      font-size: 22px;
    }
    
    h2 {
      font-size: 18px;
    }
    
    /* Make modals scrollable */
    .modal-content {
      max-height: 90vh;
      overflow-y: auto;
    }
  }
  
  /* ===== SAFE AREA SUPPORT (NOTCHES) ===== */
  @supports (padding: max(0px)) {
    body {
      padding-left: max(0px, env(safe-area-inset-left));
      padding-right: max(0px, env(safe-area-inset-right));
      padding-bottom: max(0px, env(safe-area-inset-bottom));
    }
    
    header {
      padding-top: max(0px, env(safe-area-inset-top));
    }
  }
  
  /* ===== DARK MODE MOBILE OPTIMIZATIONS ===== */
  @media (prefers-color-scheme: dark) and (max-width: 768px) {
    /* Reduce eye strain on OLED screens */
    body {
      background: #000000;
    }
    
    /* Optimize contrast */
    .card,
    .panel {
      background: #1a1a1a;
      border: 1px solid #333;
    }
  }
  
  /* ===== HIGH DPI SCREENS (RETINA) ===== */
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    /* Optimize for high-DPI displays */
    img {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }
  }
  
  /* ===== REDUCED MOTION SUPPORT ===== */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
  
  /* ===== ACCESSIBILITY - INCREASE CONTRAST ===== */
  @media (prefers-contrast: high) {
    button,
    .btn {
      border: 2px solid currentColor;
    }
    
    a {
      text-decoration: underline;
    }
  }
  
  /* ===== FOLDABLE DEVICES SUPPORT ===== */
  @media (min-width: 600px) and (max-width: 900px) and (min-height: 600px) {
    /* Optimize for foldable devices like Samsung Galaxy Fold */
    .container {
      max-width: 100%;
      padding: 0 24px;
    }
  }
</style>

<script>
  // Mobile-specific JavaScript optimizations
  (function() {
    'use strict';
    
    // Detect device type
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const isAndroid = /Android/i.test(navigator.userAgent);
    
    // Add device class to body
    if (isMobile) {
      document.documentElement.classList.add('is-mobile');
    }
    if (isIOS) {
      document.documentElement.classList.add('is-ios');
    }
    if (isAndroid) {
      document.documentElement.classList.add('is-android');
    }
    
    // Prevent zoom on input focus (iOS)
    if (isIOS) {
      const addMaxScale = () => {
        const viewport = document.querySelector('meta[name=viewport]');
        if (viewport) {
          viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0';
        }
      };
      
      document.addEventListener('touchstart', addMaxScale, { passive: true });
    }
    
    // Fix viewport height for mobile browsers (accounts for address bar)
    function setVH() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    
    setVH();
    window.addEventListener('resize', setVH);
    window.addEventListener('orientationchange', setVH);
    
    // Optimize touch events
    let touchStartTime = 0;
    document.addEventListener('touchstart', function() {
      touchStartTime = Date.now();
    }, { passive: true });
    
    document.addEventListener('touchend', function(e) {
      const touchDuration = Date.now() - touchStartTime;
      // If touch was very quick, it's likely a tap
      if (touchDuration < 200) {
        e.target.classList.add('quick-tap');
        setTimeout(() => {
          e.target.classList.remove('quick-tap');
        }, 300);
      }
    }, { passive: true });
    
    // Prevent double-tap zoom
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
    
    // Optimize images for device pixel ratio
    if (window.devicePixelRatio > 1) {
      document.documentElement.classList.add('retina');
    }
    
    // Handle orientation changes
    window.addEventListener('orientationchange', function() {
      // Force repaint
      document.body.style.display = 'none';
      document.body.offsetHeight; // Trigger reflow
      document.body.style.display = '';
    });
    
    // Log device info for debugging (remove in production)
    console.log('ðŸ“± Device Info:', {
      userAgent: navigator.userAgent,
      screenWidth: window.screen.width,
      screenHeight: window.screen.height,
      viewportWidth: window.innerWidth,
      viewportHeight: window.innerHeight,
      pixelRatio: window.devicePixelRatio,
      orientation: screen.orientation ? screen.orientation.type : 'unknown'
    });
  })();
</script>

