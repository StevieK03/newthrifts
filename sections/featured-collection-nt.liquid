{{ 'featured-collection-nt.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign collection = collections[section.settings.collection]
  assign products_limit = section.settings.products_limit | default: 12
  assign columns_desktop = section.settings.columns_desktop | default: 4
  assign columns_tablet = section.settings.columns_tablet | default: 2
  assign columns_mobile = section.settings.columns_mobile | default: 1
-%}

<section class="nt-featured-collection" id="nt-featured-{{ section.id }}" data-section-id="{{ section.id }}">
  <div class="nt-featured-collection__top-divider"></div>
  
  <div class="container">
    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <header class="nt-featured-collection__header">
        <div class="nt-featured-collection__header-content">
          {%- if section.settings.heading != blank -%}
            <h2 class="nt-featured-collection__heading">{{ section.settings.heading }}</h2>
          {%- endif -%}
          {%- if section.settings.subheading != blank -%}
            <p class="nt-featured-collection__subheading">{{ section.settings.subheading }}</p>
          {%- endif -%}
        </div>
        {%- if collection != empty -%}
          <a href="{{ collection.url }}" class="nt-featured-collection__view-all" aria-label="View all products in {{ collection.title }}">
            View All
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14m-7-7l7 7-7 7"/>
            </svg>
          </a>
        {%- endif -%}
      </header>
    {%- endif -%}

    {%- if collection == empty or collection.products.size == 0 -%}
      <div class="nt-featured-collection__empty">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <h3>No products found</h3>
        <p>This collection is empty. Please select a collection with products.</p>
        <a href="{{ routes.collections_url }}" class="nt-featured-collection__empty-cta">Browse All Products</a>
      </div>
    {%- else -%}
      <ul class="nt-featured-collection__grid"
          style="--cols-desktop: {{ columns_desktop }}; --cols-tablet: {{ columns_tablet }}; --cols-mobile: {{ columns_mobile }};"
          role="list">
        {%- for product in collection.products limit: products_limit -%}
          <li class="nt-featured-collection__item">
            <article class="nt-product-card nt-product-card--{{ section.settings.card_style }}" 
                     data-product-id="{{ product.id }}">
              
              {%- comment -%} Product Image {%- endcomment -%}
              <div class="nt-product-card__image-wrapper">
                <a href="{{ product.url }}" class="nt-product-card__image-link" aria-label="View {{ product.title }}">
                  {%- if product.featured_media -%}
                    {%- assign image_alt = product.featured_media.alt | default: product.title -%}
                    {{- product.featured_media | image_url: width: 800 | image_tag:
                      loading: 'lazy',
                      class: 'nt-product-card__image',
                      alt: image_alt,
                      widths: '200, 300, 400, 500, 600, 800',
                      sizes: '(min-width: 1024px) 25vw, (min-width: 768px) 33vw, 50vw'
                    -}}
                  {%- else -%}
                    <div class="nt-product-card__image nt-product-card__image--placeholder">
                      {{ 'product-1' | placeholder_svg_tag: 'nt-product-card__placeholder-svg' }}
                    </div>
                  {%- endif -%}
                </a>

                {%- comment -%} Badges {%- endcomment -%}
                {%- if section.settings.show_badges -%}
                  <div class="nt-product-card__badges">
                    {%- if product.available == false -%}
                      <span class="nt-badge nt-badge--sold-out">Sold Out</span>
                    {%- else -%}
                      {%- if product.compare_at_price > product.price -%}
                        {%- assign discount = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
                        <span class="nt-badge nt-badge--sale">-{{ discount }}%</span>
                      {%- endif -%}
                      {%- if product.metafields.custom.badge != blank -%}
                        <span class="nt-badge nt-badge--custom">{{ product.metafields.custom.badge }}</span>
                      {%- endif -%}
                    {%- endif -%}
                  </div>
                {%- endif -%}

                {%- comment -%} Quick Actions {%- endcomment -%}
                <div class="nt-product-card__quick-actions">
                  {%- if section.settings.enable_quick_view -%}
                    <button type="button" 
                            class="nt-product-card__quick-btn"
                            data-quick-view="{{ product.id }}"
                            aria-label="Quick view {{ product.title }}">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                      </svg>
                    </button>
                  {%- endif -%}
                  <button type="button" 
                          class="nt-product-card__quick-btn nt-product-card__wishlist"
                          data-wishlist-add="{{ product.id }}"
                          aria-label="Add {{ product.title }} to wishlist">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                  </button>
                </div>
              </div>

              {%- comment -%} Product Content {%- endcomment -%}
              <div class="nt-product-card__content">
                {%- if section.settings.show_vendor and product.vendor != blank -%}
                  <div class="nt-product-card__vendor">{{ product.vendor }}</div>
                {%- endif -%}

                <h3 class="nt-product-card__title">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h3>

                {%- if section.settings.show_rating -%}
                  <div class="nt-product-card__rating">
                    <div class="nt-rating" role="img" aria-label="Rating: 4.5 out of 5 stars">
                      <div class="nt-rating__stars" style="--rating: 4.5;">
                        <span>★★★★★</span>
                      </div>
                      <span class="nt-rating__count">({{ product.metafields.reviews.rating_count | default: 0 }})</span>
                    </div>
                  </div>
                {%- endif -%}

                {%- comment -%} Swatches {%- endcomment -%}
                {%- if section.settings.show_swatches -%}
                  {%- assign color_option = product.options_by_name['Color'] | default: product.options_by_name['Colour'] -%}
                  {%- if color_option -%}
                    <div class="nt-product-card__swatches">
                      {%- for value in color_option.values limit: 5 -%}
                        {%- assign color_value = value | downcase | replace: ' ', '-' -%}
                        <span class="nt-swatch" 
                              style="background-color: {{ value | downcase | replace: ' ', '' }};"
                              title="{{ value }}"
                              aria-label="{{ value }}"></span>
                      {%- endfor -%}
                      {%- if color_option.values.size > 5 -%}
                        <span class="nt-swatch-more">+{{ color_option.values.size | minus: 5 }}</span>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                {%- endif -%}

                {%- comment -%} Price {%- endcomment -%}
                <div class="nt-product-card__price">
                  {%- if product.compare_at_price > product.price -%}
                    <span class="nt-price nt-price--compare">
                      {{ product.compare_at_price | money }}
                    </span>
                  {%- endif -%}
                  <span class="nt-price nt-price--current">
                    {{ product.price | money }}
                  </span>
                </div>

                {%- comment -%} Quick Add Button {%- endcomment -%}
                {%- if section.settings.enable_quick_add -%}
                  <div class="nt-product-card__actions">
                    {%- if product.available -%}
                      {%- if product.has_only_default_variant -%}
                        <button type="button" 
                                class="nt-product-card__add-btn"
                                data-product-id="{{ product.selected_or_first_available_variant.id }}"
                                aria-label="Add {{ product.title }} to cart">
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"/>
                            <circle cx="20" cy="21" r="1"/>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                          </svg>
                          <span>Add to Cart</span>
                        </button>
                      {%- else -%}
                        <a href="{{ product.url }}" class="nt-product-card__add-btn">
                          <span>Select Options</span>
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14m-7-7l7 7-7 7"/>
                          </svg>
                        </a>
                      {%- endif -%}
                    {%- else -%}
                      <button type="button" class="nt-product-card__add-btn" disabled>
                        <span>Sold Out</span>
                      </button>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </div>
            </article>
          </li>
        {%- endfor -%}
      </ul>
    {%- endif -%}
  </div>
</section>

<script src="{{ 'featured-collection-nt.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Featured Collection (NT)",
  "tag": "section",
  "class": "section-featured-collection-nt",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Collection"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Discover our handpicked favorites"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "products_limit",
      "min": 4,
      "max": 24,
      "step": 2,
      "default": 12,
      "label": "Products to show"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 3,
      "max": 4,
      "step": 1,
      "default": 4,
      "label": "Columns (Desktop)"
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 2,
      "label": "Columns (Tablet)"
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 1,
      "label": "Columns (Mobile)"
    },
    {
      "type": "header",
      "content": "Card Style"
    },
    {
      "type": "select",
      "id": "card_style",
      "label": "Card Style",
      "options": [
        {
          "value": "elevated",
          "label": "Elevated (Shadow)"
        },
        {
          "value": "outlined",
          "label": "Outlined (Border)"
        },
        {
          "value": "bordered",
          "label": "Bordered (Accent)"
        }
      ],
      "default": "elevated"
    },
    {
      "type": "header",
      "content": "Product Card Display"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "Show badges (Sale, Custom)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_swatches",
      "label": "Show color swatches",
      "default": true
    },
    {
      "type": "header",
      "content": "Interactive Features"
    },
    {
      "type": "checkbox",
      "id": "enable_quick_add",
      "label": "Enable quick add to cart",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_quick_view",
      "label": "Enable quick view",
      "default": true
    },
    {
      "type": "header",
      "content": "Theme"
    },
    {
      "type": "checkbox",
      "id": "enable_auto_theme",
      "label": "Enable automatic theme switching",
      "default": true,
      "info": "Respects system dark/light mode preference"
    }
  ],
  "presets": [
    {
      "name": "Featured Collection (NT)"
    }
  ]
}
{% endschema %}

